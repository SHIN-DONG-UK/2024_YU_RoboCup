### 🚀 handleHDrive() 함수 문서

## 🎯 함수 목적 요약

- `optimum_path()`로 계산된 최적 경로(`node_rot[]`, `node_dis[]`)를 따라
마이크로마우스를 **고속으로 자동 주행**시키는 함수

- **각 노드 단위로 직진 및 회전 제어**를 수행하고,
마지막 노드까지 도달하면 상태를 `FINISH`로 변경

## 📥 Input: 없음
- 전역 변수 사용:

   - `node_end`: 주행할 경로 길이

   - `node_rot[]`, `node_dis[]`: 최적 경로 회전 및 거리 정보

   - `MM`: 마이크로마우스 하드웨어 제어 모듈

## 🧭 핵심 로직 단계

### 1️⃣ 주행 초기화
```cpp
vss = VSS_FINISH;
MM.Set_velo_gain(...);
MM.Set_dis_gain(...);
vlim = 30;
```
- PID·속도 파라미터 고속 주행용으로 변경

### 2️⃣ 버튼 대기 (시작 조건)
```cpp
while (버튼 누름/뗌 대기) { ... }
```
- **버튼을 눌렀다가 때는 행동**을 통해 고속 주행 시작
- OLED 상태 변경

### 3️⃣ 라인 감지 센서 확인
```cpp
while (!(p1 && p2)) { ... }
```
- 양쪽 센서가 검은색을 인식할 때까지 대기

### 4️⃣ 메인 주행 루프 시작
```cpp
while (1) {
    ...
}
```

### 5️⃣ 📏 직진 구간 주행
```cpp
if (node_dis[node] > 1) {
    if (node_dis[node] > 10) vH=180;
    else if (...) ...
    dis = (node_dis[node] - 1) * UNIT_DIST + 450;
    vel_dis = 1;
    ...
    while (누적 엔코더 거리 < dis) {
        MM.cal_pos(850);
        vd 증가;
    }
}
```
- `node_dis[node]` 값에 따라 감속/가속 설정
- 거리 제어로 직진 구간 주행

### 6️⃣ ↪️ 노드 회전 처리
```cpp
if (node < node_end) {
    vel_dis = 0;
    ...
    while (MM.det == 2) { ... }
    ...
    turn(700 * (node_rot[node] - 2));
    node++;
}
```
- 주행 중 라인 인식 -> 노드에 도달
- 추가 이동 후 `turn()` 함수를 통해 회전 수행
- 회전 정보는 `node_rot[node]`에 저장되어 있음

### 7️⃣ 🏁 최종 노드 도착 처리
```cpp
else {
    while (MM.det == 2) { ... }
    vd = 0; wd = 0;
    sta = FINISH;
    vss = VSS_FINISH;
}
```
- 마지막 노드까지 이동 완료되면
   - 속도/회전 모두 0으로 설정
   - `sta` 상태를 `FINISH`로 설정해 종료 상태로 전환

## 📤 Output: 없음
- 전역 상태(`sta`, `vss`, `node`) 변경

## 🧠 요약
| 기능       | 설명                  |
| -------- | ------------------- |
| 🔧 초기 설정 | PID 계수 및 속도 제한 설정   |
| ⏳ 버튼 대기  | 주행 시작을 위해 사용자 입력 대기 |
| 📍 직진 주행 | 거리 기반 속도 제어         |
| 🔄 회전 처리 | 각 노드별 회전 수행         |
| 🏁 종료 처리 | 최종 노드 도달 시 상태 종료 설정 |
