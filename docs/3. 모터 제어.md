# ⚙️ 모터 제어(Motor control)
## 1. Feedback Loop
### 1-1. Open Loop vs Closed Loop
|구분 | Open Loop (개루프) | Closed Loop (폐루프, Feedback)|
| :-- | :-- | :-- |
기본 정의 | 출력(결과)을 측정‧반영하지 않고 입력만 적용 | 센서로 출력을 측정하여 목표‑값과의 오차를 계산, 입력을 실시간으로 보정
외란·모델 오차 대응 | `취약` – 부하 변화·노화·환경변화에 민감 | `강건` – 피드백이 외란·모델 불확실성 보정

### 1-2. 제어 입력과 피드백 - 샤워기 레버
![alt text](/data/3/3_1.png)

| 구분 | 내용 |
| :-- | :-- |
| 목표 | 물의 온도를 `20도`로 맞추고자 함 |
| 입력 변환 | `적절한 각도`로 레버를 회전 |
| 제어 대상 | 샤워기에서 레버 위치에 `해당하는 온도`의 물이 나옴 |
| 결과 | 물의 온도가 `원하는 온도`인지를 감지 |
| 피드백 | 그렇지 않으면, 레버의 위치를 바꿈 |

### 1-3. 제어 입력과 피드백 - 모터 제어
![alt text](/data/3/3_2.png)
![alt text](/data/3/3_3.png)
| 구분 | 내용 |
| :-- | :-- |
| 목표 | 전방 로봇과의 거리를 `s`라 함 |
| 결과 | 측정 거리가 `d`로 측정됨 |
| 오차 | $e = s - d$ |
| 피드백 | 오차 e값을 이용하여 로봇의 속도를 결정 |

## 2. PID 제어기
### 2-1. 제어기
![alt text](/data/3/3_4.png)

- 입력 변환 : 제어 대상이 설정된 목표값을 가질 수 있도록 입력값을 `적절하게` 변환하는 장치

- 입력 변환기는 일반적으로 결과-목표값인 `오차값(error)`을 입력으로 함

- 이러한 입력 변환 과정을 `제어기(Controller)`라고 함

- 제어의 핵심은 이 `제어기(Controller)`를 정교하게 설계하는 것

### 2-2. PID 제어기 설계
![alt text](/data/3/3_5.png)

- 시스템의 입력 `u`를 오차값(목표값 - 현재값)의 `변형`을 통해 결정

- 이 변형의 요소는 `오차값`, 오차값의 `미분`, 오차값의 `적분`임

- 각 요소에 대한 가중치를 게인(gain)이라고 함

### 2-3. PID 제어기 설계 - P 제어
> **P(Proportional) : 비례 제어**  
> $P_{out} = K_pe(t)$

![alt text](/data/3/3_6.png)

| 구분 | P Gain (비례이득, Kp) |
| :-- | :-- |
| 정의 | 제어량(시스템 입력)을 에러값(목표 - 현재값)에 비례하는 값으로 설정하는 방법 |
| 주요 역할 | - 시스템 반응(상승 시간) 가속 <br> - 정상상태 오차(steady‑state error) 감소 |
| Kp `↑` | - Rise time `↓` <br> - Overshoot `↑` 및 진동 가능 |
| Kp `↓` | - 시스템 안정성 `↑` <br> - 반응 속도 `↓` <br> - 정상상태 오차↑ (목표에 못 미침) |

### 2-4. PID 제어기 설계 - I 제어
> **I(Integral) : 적분 제어**  
> $I_{out} = K_i\int e(t)dt$ 

![alt text](/data/3/3_7.png)

| 구분 | I Gain (적분이득, Ki) |
| :-- | :-- |
| 정의 | 제어량(시스템 입력)을 에러값(목표 - 현재값)의 적분에 비례하는 값으로 설정하는 방법 |
| 주요 역할 | - 정상상태 오차(steady‑state error) 제거  <br> - 장시간 외란‧부하 변화에 대한 장기 보상 |
| Ki `↑` | - 정상상태 오차 제거 속도 `↑` (0 수렴 가속) <br> - Overshoot·Settling time `↑`, 발진 위험 증가 |
| Ki `↓` | - 정상상태 오차 제거 속도 `↓` <br> - Overshoot `↓`, 안정성 `↑` <br> - 외란 보상 능력 `↓` |

#### 📊 근사화된 적분 표현 (구분구적법)

![alt text](/data/3/3_8.png)

- 아두이노는 정확한 수학적 적분을 구현하지 못함.

- 적분은 그래프의 넓이를 의미하므로, 현재 측정값에 측정시간을 곱한 사각형의 넓이를 누적해 적분을 근사화 할 수 있음.

- 보다 정확한 근사를 위해서는 `측정간격이 일정`해야 함. 이는 `타이머 인터럽트`로 해결

#### 📟 아두이노 구현

- 적분은 시간이 지날수록 점점 큰 값을 가짐

- 하지만 너무 오랜 시간 동안 오차가 누적될 경우, 아두이노에서 처리할 수 있는 한계를 넘어 버림

- `Constrain` 명령어를 이용해 적분의 한계점을 지정

```c
a = constrain(b, c, d)
```

- b값이 c보다 작으면 a=c가 됨
- b값이 d보다 크면 a=d가 됨
- 두 해당사항이 아닌 경우, a=b가 됨

```c
//사용 예시
k = constrain(Ki, -10, 20)
```

### 2-5. PID 제어기 설계 - D제어
> **D(Differential) : 미분제어**  
> $D_{out} = K_d \frac{d}{dt}e(t)$

![alt text](/data/3/3_9.png)

| 구분 | D Gain (미분이득, Kd) |
| :-- | :-- |
| 정의 | 제어량(시스템 입력)을 미분에 비례하도록 설정하는 방법 |
| 주요 역할 | - 급격한 오차 변화(Overshoot·진동) 감쇠 <br> - Settling time 단축·안정성 향상(예측 제어 -> 반응성 향상) |

#### 📟 아두이노 구현
![alt text](/data/3/3_10.png)

- 아두이노에서는 정확한 수학적 미분을 구현하지 못함

- 미분은 그 점에서의 기울기를 의미하므로, 이전 측정값과 현재 측정값의 `변화량`으로 미분을 근사화할 수 있음

- 보다 정확한 근사를 위해서는 `측정간격이 일정`해야 함

- `타이머 인터럽트`를 이용해, 일정한 측정 간격을 구현할 수 있음

### 2-6. PID 제어기의 최종 형태
![alt text](/data/3/3_11.png)

## 3. 제어기 설계?? 근데 이 부분 강의 안들어서 모르겠노